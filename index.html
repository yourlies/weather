<!DOCTYPE html>
<html>

<head>
  <title>weather</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <style>
    body {
      background-color: #fff;
      margin: 0px;
      overflow: hidden;
    }

    #canv {
      position: absolute;
    }

    .wrap {
      position: absolute;
    }
  </style>
</head>

<body>
  <div>
    <div>
      <canvas id="canv0" width="1000" height="300"></canvas>
    </div>
    <div>
      <canvas id="canv1" width="1000" height="300"></canvas>
    </div>
  </div>
  <div class="wrap"></div>
  <script>
    var $process = {}
  </script>
  <script src="./drop.js"></script>
  <script src="./weather.js"></script>
  <script>
    var watchers = []
    var package = function (id) {
      var canv = document.getElementById(id)
      var drop = new $process.Drop({
        canv: canv
      })
      var recycle = function (e) {
        drop.watcher({
          x: e.x,
          y: e.y,
          forward: 1
        })
      }
      var weather = new $process.Weather(canv, recycle)
      var rainy = new $process.Rainy(weather)
      watchers.push(drop)
      watchers.push(rainy)
      watchers.unshift({
        updater: function () {
          weather.ctx.clearRect(0, 0, weather.width, weather.height)
        }
      })

      return {
        drop: drop,
        weather: weather,
        raint: rainy,
        canv: canv
      }
    }
    package('canv0')
    package('canv1')

    var raf = function () {
      watchers.forEach(function (e) {
        e.updater()
      })
      requestAnimationFrame(raf)
    }
    requestAnimationFrame(raf)
  </script>
</body>

</html>