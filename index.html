<!DOCTYPE html>
<html>
<head>
  <title>weather</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <style>
    body {
      background-color: #fff;
      margin: 0px;
      overflow: hidden;
    }
    #canv {
      position: absolute;
    }
    .wrap {
      position: absolute;
    }
  </style>
</head>
<body>
  <canvas id='canv'></canvas>
  <div class="wrap">
  </div>
  <script>
    var $process = {};
  </script>
  <script src="./drop.js"></script>
  <script src="./weather.js"></script>
  <script src="./thunder.js"></script>
  <script>
    ;(function () {
      var watchers = [];
      var canv = document.getElementById('canv');
      var ctx = canv.getContext('2d');

      var width = window.innerWidth;
      var height = window.innerHeight;

      var drop = new $process.Drop({ canv: canv, ctx: ctx });

      var recycle = function (e) {
        drop.watcher({ x: e.x, y: e.y, forward: 1 });
      }
      var rainy = new $process.Rainy({ recycle: recycle, ctx: ctx });
      var thunder = new $process.Thunder({ ctx: ctx, width: width, height: height });

      watchers.push(drop);
      watchers.push(rainy);
      watchers.push(thunder);

      var raf = function () {
        ctx.clearRect(0, 0, width, height);
        watchers.forEach(function (e) {
          e.updater();
        });
        requestAnimationFrame(raf);
      }
      requestAnimationFrame(raf);
      window.onmousedown = function (e) {
        drop.watcher({ x: e.clientX, y: e.clientY });
      }
    })();
  </script>
</body>
</html>